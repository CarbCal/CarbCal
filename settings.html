<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <!-- Dark mode toggle fix attempt -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

        /* --- Base & Light Mode --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #212529;
            background-image: url('Bread.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .navbar {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .navbar-brand {
            color: #212529;
        }

        .container h2, .container h3 {
            color: #212529;
        }

        .accordion-item {
            background-color: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.1);
            margin-bottom: .5rem;
        }

        .accordion-button {
            background-color: #f8f9fa;
            color: #212529;
            border-radius: 1.5rem;
        }
        
        .accordion-button:not(.collapsed) {
            background-color: #e7f1ff;
            color: #0c63e4;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        .accordion-body {
            background-color: #fff;
            color: #212529;
            border-bottom-left-radius: 1.5rem;
            border-bottom-right-radius: 1.5rem;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }

        /* --- Dark Mode Overrides (match index.html) --- */
        body.dark-mode {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }

        body.dark-mode::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: -1;
        }

        body.dark-mode .navbar {
            background-color: #2d2d2d !important;
            color: #f8f9fa !important;
            border-bottom: 1px solid #333;
            box-shadow: 0 2px 4px rgba(0,0,0,.3);
        }

        body.dark-mode .navbar-brand {
            color: #f8f9fa !important;
        }

        body.dark-mode .container h2,
        body.dark-mode .container h3 {
            color: #f8f9fa !important;
        }
        
        body.dark-mode .accordion-item {
            background-color: #2d2d2d !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0,0,0,.3);
        }

        body.dark-mode .accordion-button {
            background-color: #333 !important;
            color: #e0e0e0 !important;
            border-radius: 1.5rem;
        }
        
        body.dark-mode .accordion-button:not(.collapsed) {
            background-color: rgb(60, 60, 60) !important;
            color: #f8f9fa !important;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        body.dark-mode .accordion-body {
            background-color: #222222 !important;
            color: #f8f9fa !important;
            border-bottom-left-radius: 1.5rem;
            border-bottom-right-radius: 1.5rem;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }

        body.dark-mode .form-check-label {
            color: #e0e0e0 !important;
        }

        body.dark-mode .form-control {
            background-color: #222222 !important;
            color: #f8f9fa !important;
            border-color: #555 !important;
        }

        body.dark-mode .form-control:focus {
            background-color: #222222 !important;
            color: #f8f9fa !important;
            border-color: #777 !important;
            box-shadow: 0 0 0 0.25rem rgba(192, 192, 192, 0.25) !important;
        }

        body.dark-mode .form-control::placeholder {
            color: #bbb !important;
        }

        .form-check.form-switch {
            display: flex !important;
            align-items: center;
            padding-left: 0;
        }

        .form-check.form-switch .form-check-input {
            width: 3em;
            height: 1.5em;
        }

        .form-check.form-switch .form-check-label {
            margin-left: 0;
        }

        body.dark-mode #forceOpenFoodFactsToggle.form-check-input:checked {
            background-color: #0c63e4 !important;
            border-color: #0c63e4 !important;
        }
        body.dark-mode #forceOpenFoodFactsToggle.form-check-input {
            background-color: #444 !important;
            border-color: #888 !important;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container-fluid">
            <a href="index.html" class="navbar-brand mb-0 h1"><i class="bi bi-arrow-left"></i> Back</a>
        </div>
    </nav>

    <div class="container my-4">
        <h2 class="mb-4">Settings</h2>
        <div class="accordion mt-4" id="settingsAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingVisual">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseVisual" aria-expanded="false" aria-controls="collapseVisual">
                        Visual
                    </button>
                </h2>
                <div id="collapseVisual" class="accordion-collapse collapse" aria-labelledby="headingVisual" data-bs-parent="#settingsAccordion">
                    <div class="accordion-body">
                        <div class="form-check form-switch d-flex justify-content-between align-items-center">
                            <label class="form-check-label" for="darkModeToggle"><i class="bi bi-moon-stars-fill"></i> Dark Mode</label>
                            <input class="form-check-input ms-auto" type="checkbox" id="darkModeToggle">
                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOnlineSearch">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOnlineSearch" aria-expanded="false" aria-controls="collapseOnlineSearch">
                        Online Search
                    </button>
                </h2>
                <div id="collapseOnlineSearch" class="accordion-collapse collapse" aria-labelledby="headingOnlineSearch" data-bs-parent="#settingsAccordion">
                    <div class="accordion-body">
                        <div class="form-check form-switch d-flex justify-content-between align-items-center mb-3">
                            <label class="form-check-label" for="forceOpenFoodFactsToggle"><i class="bi bi-globe"></i> Force Open Food Facts API</label>
                            <input class="form-check-input ms-auto" type="checkbox" id="forceOpenFoodFactsToggle">
                        </div>

                        <div class="mb-3">
                            <label for="nutritionixAppId" class="form-label">Nutritionix App ID</label>
                            <input type="text" class="form-control" id="nutritionixAppId" placeholder="Enter Nutritionix App ID">
                        </div>
                        <div class="mb-3">
                            <label for="nutritionixAppKey" class="form-label">Nutritionix App Key</label>
                            <input type="password" class="form-control" id="nutritionixAppKey" placeholder="Enter Nutritionix App Key">
                        </div>
                        <div class="mb-3">
                            <label for="edamamAppId" class="form-label">Edamam App ID</label>
                            <input type="text" class="form-control" id="edamamAppId" placeholder="Enter Edamam App ID">
                        </div>
                        <div class="mb-3">
                            <label for="edamamAppKey" class="form-label">Edamam App Key</label>
                            <input type="password" class="form-control" id="edamamAppKey" placeholder="Enter Edamam App Key">
                        </div>
                        
                        <button id="saveApiKeys" class="btn btn-primary">Save API Keys</button>
                    </div>
                </div>
            </div>
            
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingAbout">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAbout" aria-expanded="false" aria-controls="collapseAbout">
                        About Carb Calculator
                    </button>
                </h2>
                <div id="collapseAbout" class="accordion-collapse collapse" aria-labelledby="headingAbout" data-bs-parent="#settingsAccordion">
                    <div class="accordion-body">
                        <p>This application helps you easily calculate carbohydrates, save your favorite food items, and find nutrition information online.</p>

                        <h4 class="mt-4">How to Use</h4>
                        <ul>
                            <li><strong>Dark Mode Toggle:</strong> Switch between light and dark themes.</li>
                            <li><strong>Carb Calculator:</strong> Calculate total carbs based on per 100g values and weight.</li>
                            <li><strong>Online Search:</strong> Find nutrition data for various foods using external APIs.</li>
                            <li><strong>Saved Items:</strong> Store and manage your frequently used food items.</li>
                        </ul>

                        <h4 class="mt-4">Features in Detail</h4>
                        <h5 class="mt-2">1. Dark Mode Toggle</h5>
                        <p>Switch between a light and dark theme for comfortable viewing. Your preference is saved automatically. You can find the toggle switch in the <strong>top right corner of the navigation bar</strong> on both the main app and settings pages.</p>

                        <h5 class="mt-4">2. Carb Calculator</h5>
                        <p>
                            Enter the "Carbohydrates per 100g" of your food and its "Weight of Food (g)" in the input fields. Click the <strong>"Calculate" button</strong> to see the total carbohydrates. The result will appear in a card below. You can then label your calculated item in the <strong>"Label your item" text box</strong> and click the <strong>"Add" button</strong> to save it to your "Saved Items" list. The <strong>"Close" button</strong> on the result card will hide it.
                        </p>

                        <h5 class="mt-4">3. Online Search</h5>
                        <p>
                            To search for food items online, navigate to the <strong>"Online Search" tab</strong>. Type your query into the <strong>search box</strong> and click the <strong>"Search" button</strong>. The app will first try to find results using the Nutritionix API. If that doesn't work, it will automatically try the Edamam API, and then the Open Food Facts API as a final fallback.
                            Click on any search result in the list to see detailed nutrition facts in a pop-up window. Click the <strong>"Use" button</strong> next to a search result to automatically fill the calculator with its carbohydrate and serving information.
                        </p>

                        <h5 class="mt-4">4. Saved Items</h5>
                        <p>
                            To manage your frequently used food items, navigate to the <strong>"Saved Items" tab</strong>. You can search through your saved items using the <strong>search input field</strong>.
                            Click the <strong>"Use" button</strong> next to a saved item to quickly load its details into the calculator.
                            Click the <strong>trash can icon</strong> to remove a saved item (you'll be asked to confirm in a pop-up).
                            Use the <strong>"Add Custom" button</strong> to manually add a new food item to your saved list by entering its label, serving size, and carbs per serving in the modal that appears.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const forceOpenFoodFactsToggle = document.getElementById('forceOpenFoodFactsToggle');
            const nutritionixAppIdInput = document.getElementById('nutritionixAppId');
            const nutritionixAppKeyInput = document.getElementById('nutritionixAppKey');
            const edamamAppIdInput = document.getElementById('edamamAppId');
            const edamamAppKeyInput = document.getElementById('edamamAppKey');
            
            const saveApiKeysButton = document.getElementById('saveApiKeys');

            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    if (darkModeToggle) {
                        darkModeToggle.checked = true;
                    }
                } else {
                    document.body.classList.remove('dark-mode');
                    if (darkModeToggle) {
                        darkModeToggle.checked = false;
                    }
                }
            };

            // Load saved preferences
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                applyTheme(savedTheme);
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                applyTheme('dark');
            }

            const forceOpenFoodFacts = localStorage.getItem('forceOpenFoodFacts');
            if (forceOpenFoodFacts === 'true') {
                forceOpenFoodFactsToggle.checked = true;
            } else {
                forceOpenFoodFactsToggle.checked = false;
            }

            // Load API keys
            nutritionixAppIdInput.value = localStorage.getItem('nutritionixAppId') || '';
            nutritionixAppKeyInput.value = localStorage.getItem('nutritionixAppKey') || '';
            edamamAppIdInput.value = localStorage.getItem('edamamAppId') || '';
            edamamAppKeyInput.value = localStorage.getItem('edamamAppKey') || '';
            

            // Event Listeners for toggles
            darkModeToggle.addEventListener('click', () => {
                const theme = darkModeToggle.checked ? 'dark' : 'light';
                localStorage.setItem('theme', theme);
                applyTheme(theme);
            });

            forceOpenFoodFactsToggle.addEventListener('click', () => {
                localStorage.setItem('forceOpenFoodFacts', forceOpenFoodFactsToggle.checked);
            });

            // Event Listener for saving API keys
            saveApiKeysButton.addEventListener('click', () => {
                localStorage.setItem('nutritionixAppId', nutritionixAppIdInput.value);
                localStorage.setItem('nutritionixAppKey', nutritionixAppKeyInput.value);
                localStorage.setItem('edamamAppId', edamamAppIdInput.value);
                localStorage.setItem('edamamAppKey', edamamAppKeyInput.value);
                
                alert('API Keys saved!');
            });

            // Synchronize theme and API keys across tabs/windows
            window.addEventListener('storage', (event) => {
                if (event.key === 'theme') {
                    applyTheme(event.newValue);
                } else if (event.key === 'forceOpenFoodFacts') {
                    forceOpenFoodFactsToggle.checked = (event.newValue === 'true');
                } else if (event.key === 'nutritionixAppId') {
                    nutritionixAppIdInput.value = event.newValue || '';
                } else if (event.key === 'nutritionixAppKey') {
                    nutritionixAppKeyInput.value = event.newValue || '';
                } else if (event.key === 'edamamAppId') {
                    edamamAppIdInput.value = event.newValue || '';
                } else if (event.key === 'edamamAppKey') {
                    edamamAppKeyInput.value = event.newValue || '';
                }
            });
        });
    </script>
</body>
</html>
